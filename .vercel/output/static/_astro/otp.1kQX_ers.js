import{a as C,T as I,I as V}from"./Toast.D5awJpa_.js";import{A as v}from"./Anchor.C7T8HRHh.js";import{B as k}from"./Button.FTLgxezC.js";import{c as x,T as P}from"./runtime-dom.esm-bundler.hnKfWXw2.js";/* empty css                     */import{_ as w}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as p,F as S,j,o as h,l as A,n as R,b as u,d as r,w as d,r as c,g as f}from"./runtime-core.esm-bundler.CXnlPxLE.js";import{s as $,u as y}from"./register.DGVlyAii.js";/* empty css                        */import"./index.BSdFiPHn.js";const O={props:{length:{type:Number,default:6,validator:e=>e>0&&e<=10},modelValue:{type:String,default:""},placeholder:{type:String,default:"0"},disabled:{type:Boolean,default:!1},type:{type:String,default:"text",validator:e=>["text","password"].includes(e)},customClass:{type:String,default:""}},emits:["update:modelValue","complete"],data(){return{otpValues:Array(this.length).fill("")}},computed:{baseClasses(){return`
        px-1 py-1 text-base rounded-xl border-secondary-xs
        text-zinc-800
        bg-white dark:bg-zinc-900
        shadow-secondary-sm focus:ring-0 focus:outline-none
        transition-all duration-200
      `},currentOtp(){return this.otpValues.join("")}},watch:{modelValue:{handler(e){if(e!==this.currentOtp){this.otpValues=Array(this.length).fill("");for(let t=0;t<e.length&&t<this.length;t++)this.$set(this.otpValues,t,e[t])}},immediate:!0},otpValues:{handler(e){const t=e.join("");t!==this.modelValue&&this.$emit("update:modelValue",t),t.length===this.length&&this.$emit("complete",t)},deep:!0}},methods:{handleInput(e,t){const s=e.target.value;if(!/^\d*$/.test(s)){this.otpValues[t]="",e.preventDefault();return}this.otpValues[t]=s.charAt(0),this.otpValues[t]&&t<this.length-1&&this.focusInput(t+1)},handleKeydown(e,t){e.key==="Backspace"&&this.otpValues[t]===""&&t>0?(e.preventDefault(),this.focusInput(t-1)):!/^\d$/.test(e.key)&&e.key.length===1&&e.key!=="Tab"&&e.key!=="Enter"&&e.preventDefault()},handlePaste(e){if(e.target!==this.$refs.otpInputs[0])return;e.preventDefault();const t=e.clipboardData.getData("text").trim();if(!/^\d+$/.test(t))return;for(let l=0;l<this.length;l++)l<t.length?this.$set(this.otpValues,l,t[l]):this.$set(this.otpValues,l,"");const s=Math.min(t.length-1,this.length-1);this.$nextTick(()=>{this.focusInput(s)})},focusInput(e){this.$refs.otpInputs[e]?.focus()},clear(){this.otpValues=Array(this.length).fill(""),this.$nextTick(()=>{this.focusInput(0)})}},mounted(){this.$nextTick(()=>{this.disabled||this.focusInput(0)})}},D={class:"flex gap-2"},E=["id","onUpdate:modelValue","onInput","onKeydown","onPaste","type","disabled","placeholder"];function B(e,t,s,l,n,o){return h(),p("div",D,[(h(!0),p(S,null,j(n.otpValues,(m,a)=>A((h(),p("input",{key:a,id:`otp-input-${a}`,"onUpdate:modelValue":i=>n.otpValues[a]=i,onInput:i=>o.handleInput(i,a),onKeydown:i=>o.handleKeydown(i,a),onPaste:i=>o.handlePaste(i,a),type:s.type,maxlength:1,disabled:s.disabled,placeholder:s.placeholder,class:R([o.baseClasses,"w-12 py-4 text-center text-xl font-semibold",s.disabled?"bg-zinc-100 cursor-not-allowed":"",s.customClass]),inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",ref_for:!0,ref:"otpInputs"},null,42,E)),[[x,n.otpValues[a]]])),128))])}const L=w(O,[["render",B],["__scopeId","data-v-d1d507b7"]]),z="http://localhost:3000/api/v1",g=async({method:e="GET",url:t,params:s={},body:l=null,headers:n})=>{try{const o=(e==="GET"||e==="DELETE")&&Object.keys(s).length?`?${new URLSearchParams(s).toString()}`:"",m=`${z}${t}${o}`,a=await fetch(m,{method:e,headers:n||{"Content-Type":"application/json"},credentials:"include",body:e==="POST"||e==="PUT"?JSON.stringify(l):null});return a.ok,a}catch(o){throw console.error(`[API ERROR] ${e} ${t}:`,o),o}},N={components:{Input:V,Anchor:v,Button:k,ToastContainer:I,Toast:C,OTPInput:L},data(){return{isLoading:!1,useRegister:y,activeInput:"email",otpCode:"",email:"",password:"",dangerToast:{message:""}}},methods:{setActiveInput(e){this.activeInput=e},goToPassword(){if(this.email==null||this.email===""){this.dangerToast.message="Please Enter your email.";return}if(!this.email.includes("@")){this.dangerToast.message="Not an email format.";return}this.setActiveInput("password"),$(this.email),this.useRegister=y},async resendCode(){const e=await g({method:"POST",headers:{"Content-Type":"application/json"},url:"/auth/signup/resend-otp",body:{email:this.useRegister.value.email}});console.log(await e.json())},async createAccount(){console.log(typeof this.otpCode),console.log(typeof this.useRegister.value.email);const e=await g({method:"POST",headers:{"Content-Type":"application/json"},url:"/auth/signup/confirm-email",body:{email:this.useRegister.value.email,code:this.otpCode}});if(!e.ok){this.dangerToast.message="Something went wrong";return}console.log(await e.json()),await this.handleLogin()},async handleLogin(){const e=await g({method:"POST",url:"/auth/signin",body:{email:this.useRegister.value.email,password:this.useRegister.value.password}});if(!e.ok){const s=await e.json();this.dangerToast.message=s.message||"Login failed. Please check your credentials.";return}const t=await e.json();window.location.href="/build-profile",this.$emit("login-success",t)}}},U={class:"flex flex-col items-center relative pt-20 px-8 grow"},K={class:"flex flex-col items-center justify-center gap-4"};function F(e,t,s,l,n,o){const m=c("OTPInput"),a=c("Anchor"),i=c("Button"),T=c("Toast"),_=c("ToastContainer");return h(),p("div",U,[t[5]||(t[5]=u("div",{class:"flex flex-col items-center gap-4"},[u("span",{class:"text-zinc-400 font-bold"},"Start your travels in"),u("img",{class:"w-48",src:"/images/logo-agdayo-lg.png",alt:""}),u("span",{class:"baybayin text-[.5rem] text-zinc-400"},"agdayoagdayoagdayoagdayoagdayoagdayoagdayoagdayoagdayo")],-1)),r(P,{name:"fade",mode:"out-in"},{default:d(()=>[(h(),p("div",{key:n.activeInput,class:"gap-4 sm:w-72 w-full pt-20 flex flex-col items-center justify-center"},[u("div",K,[t[3]||(t[3]=f(" Enter your one-time password ")),r(m,{modelValue:n.otpCode,"onUpdate:modelValue":t[0]||(t[0]=b=>n.otpCode=b),length:6,placeholder:" ",disabled:!1,onComplete:o.createAccount},null,8,["modelValue","onComplete"]),r(a,{onClick:o.resendCode,href:"javascript:void(0)"},{default:d(()=>t[1]||(t[1]=[f("Resend Code")])),_:1},8,["onClick"]),r(i,{onClick:o.createAccount,class:"w-full"},{default:d(()=>t[2]||(t[2]=[f("Submit")])),_:1},8,["onClick"])])]))]),_:1}),r(a,{class:"pt-8",href:"/login"},{default:d(()=>t[4]||(t[4]=[f("Go Back to login")])),_:1}),r(_,null,{default:d(()=>[r(T,{variant:"error",ref:"dangerToast",message:n.dangerToast.message},null,8,["message"])]),_:1})])}const ee=w(N,[["render",F],["__scopeId","data-v-02d0609d"]]);export{ee as default};
