const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/client.Db7OmKgL.js","_astro/index.esm.vxxS9n3R.js"])))=>i.map(i=>d[i]);
import{_ as Y}from"./preload-helper.BlTxHScW.js";import{T as N}from"./runtime-dom.esm-bundler.hnKfWXw2.js";import{u as H}from"./auth.CbDBHLPr.js";import{S as K}from"./Spinner.JaC9Bi1L.js";import{C as W}from"./Card.DAiZEWK-.js";/* empty css                       */import{_ as j}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{h as A,c as r,o as i,F as q,j as U,n as w,g as k,b as t,t as f,e as x,$ as P,a0 as D,f as y,w as b,d as g,a as O,a1 as E,i as R,a2 as X}from"./runtime-core.esm-bundler.CXnlPxLE.js";import{F as Z}from"./Friends.CJDzD5b-.js";import{I as $,a as ee,T as te}from"./Toast.D5awJpa_.js";import{T as se}from"./Tag.CLo6xTH_.js";import{A as ne}from"./Anchor.C7T8HRHh.js";import"./index.BSdFiPHn.js";/* empty css                       *//* empty css                        *//* empty css                        */const ae=A({__name:"NavigationMenu",props:{tabs:{},initialActiveTabId:{}},emits:["tab-selected"],setup(m,{expose:s,emit:c}){s();const e=m,l=c,a=x(null);P(()=>{e.initialActiveTabId&&e.tabs.some(o=>o.id===e.initialActiveTabId)?a.value=e.initialActiveTabId:e.tabs.length>0&&(a.value=e.tabs[0].id),a.value&&l("tab-selected",a.value)}),D(()=>e.tabs,o=>{o.length>0&&(!a.value||!o.some(_=>_.id===a.value))&&(a.value=o[0].id,l("tab-selected",a.value))},{deep:!0});const d={props:e,emit:l,activeTabId:a,selectTab:o=>{a.value!==o&&(a.value=o,l("tab-selected",o))}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),oe={class:"flex border-b border-zinc-200 overflow-x-auto whitespace-nowrap -mx-4 px-4 md:-mx-6 md:px-6"},ie=["onClick"];function re(m,s,c,e,l,a){return i(),r("div",oe,[(i(!0),r(q,null,U(c.tabs,n=>(i(),r("button",{key:n.id,onClick:d=>e.selectTab(n.id),class:w(["py-3 px-4 text-center font-medium text-sm md:text-base","transition-colors duration-200 ease-in-out","relative group",e.activeTabId===n.id?"text-peach-600 border-b-2 border-peach-500":"text-zinc-500 hover:text-zinc-700 hover:border-zinc-300 border-b-2 border-transparent"])},[k(f(n.label)+" ",1),t("span",{class:w(["absolute bottom-0 left-0 w-full h-0.5 bg-peach-500 transition-transform duration-200 ease-in-out",e.activeTabId===n.id?"scale-x-100":"scale-x-0 group-hover:scale-x-75"])},null,2)],10,ie))),128))])}const le=j(ae,[["render",re],["__scopeId","data-v-24d0f5bc"]]),L=600,de=A({__name:"People",props:{pendingFriendships:{type:Array,default:[]},acceptedFriendships:{type:Array,default:[]}},emits:["friendRequested","friendRequestFailed"],setup(m,{expose:s,emit:c}){s();const e=m,l=x([]),a=x(""),n=x("");let d=null;const o=c,_=()=>{d&&clearTimeout(d),d=setTimeout(()=>{n.value=a.value},L)},T=async p=>{if(!(await fetch("/api/v1/friendship",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user2:p})})).ok){o("friendRequestFailed");return}o("friendRequested")},h=async p=>{const v=await fetch(`/api/v1/users?search=${p}`),{users:I}=await v.json();l.value=I};D(n,async p=>{p&&h(p)});const F={props:e,people:l,searchQuery:a,debouncedSearchQuery:n,get timeoutId(){return d},set timeoutId(p){d=p},DELAY_MS:L,emit:o,debounceInput:_,sendFriendRequest:T,fetchPeople:h,Input:$,Tag:se};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),ce={class:"flex flex-col gap-4"},ue={class:"flex gap-3 self-start items-center justify-center"},pe={class:w(["text-xl transition rounded-full flex","bg-none justify-center items-center","bg-zinc-200 aspect-square border-2 border-zinc-300","shadow-secondary-sm","border-secondary-sm","overflow-hidden h-12 w-12"])},fe=["src"],me={key:1,class:"ph ph-user"},he={class:"flex flex-col gap-0 grow"},ge={key:0,class:"font-semibold"},xe={key:1,class:"font-semibold"},_e={key:0,class:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-sm font-semibold bg-zinc-100 text-zinc-500 border border-zinc-200"},ve=["onClick"],be={key:1,class:"flex flex-col items-center justify-center gap-1 text-zinc-500 py-10"};function ye(m,s,c,e,l,a){return i(),y(N,{name:"fade",appear:""},{default:b(()=>[t("div",ce,[s[4]||(s[4]=t("div",{class:"text-2xl gap-2 font-bold flex items-center"},[t("i",{class:"ph ph-users"}),t("span",null,"Discover People")],-1)),g(e.Input,{id:"people-search","prefix-icon":"ph ph-magnifying-glass",placeholder:"Search People",modelValue:e.searchQuery,"onUpdate:modelValue":s[0]||(s[0]=n=>e.searchQuery=n),onInput:e.debounceInput},null,8,["modelValue"]),e.people.length>0?(i(!0),r(q,{key:0},U(e.people,(n,d)=>(i(),r("div",{class:w(["fadeIn p-3 rounded-3xl gap-3 shadow-secondary-md border-secondary-xs flex flex-col md:flex-row items-center justify-start md:justify-between",`fadeIn-${d}`])},[t("div",ue,[t("div",pe,[n.photoURL?(i(),r("img",{key:0,src:n.photoURL,alt:""},null,8,fe)):(i(),r("i",me))]),t("div",he,[n.displayName?(i(),r("span",ge,f(n.displayName),1)):n.email?(i(),r("span",xe,f(n.email),1)):O("",!0)])]),c.pendingFriendships.filter(o=>o.user2Uid===n.uid).length>0?(i(),r("span",_e,s[1]||(s[1]=[t("i",{class:"ph ph-hourglass-simple text-base"},null,-1),k(" Request Sent ")]))):c.pendingFriendships.filter(o=>o.user1Uid===n.uid).length>0?(i(),r("button",{key:1,onClick:o=>m.acceptFriendRequest(n.uid),class:"inline-flex items-center gap-1 px-4 py-2 rounded-full text-sm font-semibold bg-peach-500 text-white hover:bg-peach-600 transition-colors shadow-md shadow-peach-300 active:scale-95"},s[2]||(s[2]=[t("i",{class:"ph ph-hand-waving text-base"},null,-1),k(" Accept Friend Request ")]),8,ve)):(i(),y(e.Tag,{key:2,onClick:o=>e.sendFriendRequest(n),label:"Add Friend",mode:"button",icon:"ph-user-plus"},null,8,["onClick"]))],2))),256)):(i(),r("div",be,s[3]||(s[3]=[t("i",{class:"ph ph-users text-3xl"},null,-1),t("span",null,"No people found",-1)])))])]),_:1})}const we=j(de,[["render",ye]]),Te=A({__name:"index",setup(m,{expose:s}){s();const c=x(!0),e=x(H.get()),l=E({message:""}),a=E({message:""}),n=R(()=>e.value.user?.user?.photoURL),d=R(()=>e.value.user?.user?.displayName),o=R(()=>e.value.user?.user?.id),_=R(()=>e.value.user?.user?.email),T=x({}),h=async()=>{const u=await fetch("/api/v1/me");if(!u.ok){const S=await u.json();console.error(S)}T.value=await u.json()},F=u=>u?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(new Date(u)):"",p=X([{id:"friends",label:"My Friends"},{id:"people",label:"Discover People"},{id:"trips",label:"My Trips"}]),v=x(""),I=u=>{v.value=u},V=()=>{l.message="Friend Request Failed"},M=()=>{a.message="Sent Friend Request",h()},B=()=>{a.message="Friend request accepted",h()},Q=()=>{h()},J=async()=>{try{const{auth:u}=await Y(async()=>{const{auth:C}=await import("./client.Db7OmKgL.js").then(G=>G.c);return{auth:C}},__vite__mapDeps([0,1]));await u.signOut(),console.log("FIREBASE CLIENT-SIDE SIGN OUT SUCCESSFUL");const S=await fetch("/api/v1/auth/session-logout",{method:"POST",headers:{"Content-Type":"application/json"}});if(!S.ok){const C=await S.json();throw new Error(C.message||"Server-side logout failed.")}console.log("SERVER-SIDE SESSION CLEARED"),localStorage.removeItem("auth"),window.location.href="/login"}catch(u){console.error("Logout Error:",u),alert("An error occurred during logout. Please try again.")}};P(async()=>{await h(),c.value=!1});const z={isLoading:c,useAuth:e,dangerToast:l,successToast:a,photoURL:n,displayName:d,uid:o,email:_,user:T,fetchUser:h,formatDate:F,tabs:p,activeTab:v,getActiveTab:I,friendRequestFailed:V,friendRequestSuccess:M,friendAccepted:B,friendRequestCancelled:Q,logoutUser:J,Spinner:K,Card:W,NavigationMenu:le,Friends:Z,People:we,ToastContainer:te,Toast:ee,Anchor:ne};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),Fe={key:0,class:"flex items-center justify-center w-full h-[32rem]"},Se={class:"grow mt-8 md:mt-16 fadeIn"},Re={class:"absolute top-0 right-0 flex flex-row"},ke={class:"flex gap-4 flex-col sm:flex-row items-center sm:items-start"},Ie={class:w(["text-6xl transition rounded-full flex items-center justify-center","bg-none hover:text-zinc-500 cursor-pointer","bg-zinc-200 aspect-square border-2 border-zinc-300","shadow-secondary-sm","border-secondary-sm","overflow-hidden h-24 w-24"])},Ce=["src"],je={key:1,class:"ph ph-user"},Ae={class:"flex flex-col gap-4 items-start justify-center"},qe={class:"flex flex-col gap-1 items-start justify-center"},ze={class:"text-zinc-800 text-4xl font-extrabold text-shadow-secondary-md"},Ee={class:"text-zinc-400 text-xs"},Le={class:"flex flex-wrap items-center gap-2 sm:gap-5 text-sm text-zinc-500"},Ne={class:"flex items-center justify-center gap-1"},Ue={class:"flex items-center justify-center gap-1"},Pe={class:"flex items-center justify-center gap-1"},De={class:"flex flex-col gap-6"};function Oe(m,s,c,e,l,a){return i(),r(q,null,[e.isLoading?(i(),r("div",Fe,[g(e.Spinner,{label:"Loading your profile"})])):(i(),y(N,{key:1,name:"fade",appear:""},{default:b(()=>[t("div",Se,[g(e.Card,{customClass:"border-secondary-sm shadow-secondary-md relative max-w-4xl mx-auto overflow-hidden rounded-4xl bg-white flex flex-col gap-8 p-4 md:p-6!"},{default:b(()=>[t("div",Re,[g(e.Anchor,{href:"javascript:void(0)",onClick:e.logoutUser,class:"text-sm my-2 md:my-3 py-2 md:py-3"},{default:b(()=>s[0]||(s[0]=[k("Logout")])),_:1}),s[1]||(s[1]=t("div",{class:"m-2 md:m-3 p-2 md:p-3 flex items-center text-2xl hover:bg-zinc-100 transition rounded-full justify-center cursor-pointer"},[t("i",{class:"ph ph-gear"})],-1))]),t("div",ke,[t("div",Ie,[e.photoURL?(i(),r("img",{key:0,src:e.photoURL,alt:""},null,8,Ce)):(i(),r("i",je))]),t("div",Ae,[t("div",qe,[t("span",ze,f(e.displayName),1),t("span",Ee,f(e.email),1)]),t("div",Le,[t("div",Ne,[s[2]||(s[2]=t("i",{class:"ph ph-calendar-dots"},null,-1)),t("span",null,"Joined "+f(e.formatDate(e.user.createdAt)),1)]),t("div",Ue,[s[3]||(s[3]=t("i",{class:"ph ph-users"},null,-1)),t("span",null,f(e.user.acceptedFriendships.length)+" Friend"+f(e.user.acceptedFriendships.length>1?"s":""),1)]),t("div",Pe,[s[4]||(s[4]=t("i",{class:"ph ph-island"},null,-1)),t("span",null,f(e.user.tripCount)+" Trips",1)])])])]),t("div",De,[g(e.NavigationMenu,{tabs:e.tabs,"initial-active-tab-id":"friends",onTabSelected:e.getActiveTab},null,8,["tabs"]),e.activeTab==="friends"?(i(),y(e.Friends,{key:0,onFriendAccepted:e.friendAccepted,onFriendRequestCancelled:e.friendRequestCancelled,"accepted-friendships":e.user.acceptedFriendships,"pending-friendships":e.user.pendingFriendships,uid:e.user.uid},null,8,["accepted-friendships","pending-friendships","uid"])):e.activeTab==="people"?(i(),y(e.People,{key:1,onFriendRequestFailed:e.friendRequestFailed,onFriendRequested:e.friendRequestSuccess,"accepted-friendships":e.user.acceptedFriendships,"pending-friendships":e.user.pendingFriendships},null,8,["accepted-friendships","pending-friendships"])):O("",!0)])]),_:1})])]),_:1})),g(e.ToastContainer,null,{default:b(()=>[g(e.Toast,{variant:"error",message:e.dangerToast.message},null,8,["message"]),g(e.Toast,{variant:"success",message:e.successToast.message},null,8,["message"])]),_:1})],64)}const nt=j(Te,[["render",Oe]]);export{nt as default};
