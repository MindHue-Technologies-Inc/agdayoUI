/* empty css                       */import{L as d}from"./leaflet-src.C9nhyQhj.js";import{T as D,a as z,I as A}from"./Toast.BZml51HT.js";import{S as M}from"./Spinner.BnrRTTjl.js";import{T as j,C as N}from"./CardActivity.BXjmSUGg.js";import{B}from"./Button.BgwQzOqK.js";import{a as E}from"./runtime-dom.esm-bundler.CNGa7J2q.js";import{_ as P}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as l,b as a,d as m,a as g,n as k,g as b,w,f as L,F as T,j as _,r as u,o as n,t as y}from"./runtime-core.esm-bundler.Db96a2QS.js";/* empty css                       */import"./Card.B64G5Pkp.js";/* empty css                       */const O={components:{CardActivity:N,TimelineDot:j,Input:A,Spinner:M,Toast:z,Button:B,ToastContainer:D},data(){return{dangerToast:{message:""},prompt:"",isLoading:!1,isLoadingTrip:!1,map:null,mapLoaded:!1,markers:[],activities:[]}},computed:{days(){return[...new Set(this.activities.map(e=>e.datetime.split("T")[0]))]},groupedActivities(){const e=[];let t=null;return this.activities.forEach(r=>{const c=new Date(r.datetime),o=r.datetime.split("T")[0];o!==t&&(t=o,e.push({type:"day",label:this.formatIsoDateToDate(c),iso:o})),e.push({type:"activity",data:r})}),e}},methods:{async generateItinerary(){this.isLoading=!0;try{const e=await fetch("/api/v1/generate-plans",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:this.prompt,currentActivities:this.activities})});if(!e.ok)throw new Error("FAILED TO GENERATE PLANS");const t=await e.json();this.activities=t.activities||[],this.mapLoaded=!0,this.$nextTick(()=>this.initMap())}catch(e){console.error(e)}finally{this.isLoading=!1}},initMap(){this.map?this.clearMarkers():this.map=d.map("map",{zoomControl:!1});const e=d.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}),t=d.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"),r=d.layerGroup([t,e]);e.addTo(this.map),d.control.layers({Street:e,Satellite:t,Hybrid:r},{},{position:"topright"}).addTo(this.map);const c=this.activities.filter(s=>s.coordinates?.latitude&&s.coordinates?.longitude);if(c.length===0)return;const o=d.latLngBounds([]);this.markers=c.map((s,h)=>{const p=s.coordinates.latitude,v=s.coordinates.longitude;o.extend([p,v]);const x=d.marker([p,v]).addTo(this.map);return x.bindPopup(`
          <div class="p-2">
            <strong>${s.title}</strong><br>
            ${s.location}<br>
            <a href="${this.getGoogleMapsLink(s)}" target="_blank" style="color:#1e90ff;">View in Google Maps</a>
          </div>
        `),x}),this.map.fitBounds(o)},resetZoom(){if(this.map&&this.markers.length>0){const e=d.latLngBounds(this.markers.map(t=>t.getLatLng()));this.map.fitBounds(e)}},clearMarkers(){this.markers.forEach(e=>this.map.removeLayer(e)),this.markers=[]},getGoogleMapsLink(e){if(e.coordinates){const{latitude:t,longitude:r}=e.coordinates;return`https://www.google.com/maps?q=${t},${r}`}return"#"},getUserLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const t=e.coords.latitude,r=e.coords.longitude;d.marker([t,r],{icon:d.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/blue-dot.png",iconSize:[32,32]})}).addTo(this.map).bindPopup("Your Location").openPopup()})},formatIsoDateToTime(e){const t=new Date(e),r=t.getHours()%12||12,c=t.getMinutes().toString().padStart(2,"0"),o=t.getHours()>=12?"PM":"AM";return`${r}:${c} ${o}`},formatIsoDateToDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},async generateTrip(){this.isLoading=!0,this.isLoadingTrip=!0;try{const e={prompt:this.prompt,currentActivities:this.activities},t=await fetch("/api/v1/generate-trip",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const p=await t.json();console.error(p.error)}const c={...(await t.json()).trip,theme:"peach",activities:this.activities};console.log(c);const o=await fetch("/api/v1/trips",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!o){const p=await o.json();throw new Error(`Error with saving trips: ${p.message}`)}const s=await o.json();console.log(s);const h=s.tripId;console.log(h),window.location.href=`/trips/${h}`}catch(e){console.error(e.message)}finally{this.isLoading=!1,this.isLoadingTrip=!1}}}},G={class:"grow mt-8 flex flex-col gap-4 md:mt-16"},V={class:"w-full relative"},J={class:"absolute inset top-2 bottom-2 right-3 z-10"},U={key:0,class:"h-24 flex flex-col items-center justify-center w-full gap-2"},R={key:0,class:"text-zinc-400"},Z={key:1,class:"text-zinc-400"},F={key:1,class:"flex items-center justify-center w-full"},H={class:"flex w-full"},W={key:0,class:"font-semibold text-2xl text-zinc-800 my-4"},q={key:1,class:"relative flex items-center justify-center my-3"},Y={class:"relative z-10 px-4 bg-white text-zinc-500 text-sm font-semibold uppercase"},K={key:2,class:"relative"},Q={class:"absolute top-4 left-4 z-10 bg-white p-2 rounded-lg shadow-md text-sm"},X={class:"mt-1 text-zinc-600"},$={key:3,class:"w-full h-[800px] my-4 flex items-center justify-center text-zinc-400"};function tt(e,t,r,c,o,s){const h=u("Input"),p=u("Button"),v=u("Spinner"),x=u("TimelineDot"),C=u("CardActivity"),S=u("Toast"),I=u("ToastContainer");return n(),l(T,null,[a("div",G,[a("div",{class:k(["flex flex-col gap-4 items-center h-1/2 justify-end transition-all ease-in-out duration-500",{"max-h-56":o.isLoading||o.activities.length>0,"max-h-1/2":o.activities.length===0}])},[t[4]||(t[4]=a("h1",{class:"fadeIn text-4xl sm:text-5xl font-extrabold text-zinc-800 mb-8 sm:mb-12 text-center tracking-tight outfit"},[b(" Let "),a("span",{style:{"background-image":"linear-gradient(to right, #eea092, #eabf67)",color:"transparent","background-clip":"text"}},"Agdayo AI"),b(" help you plan your next trip! ")],-1)),a("div",V,[m(h,{placeholder:"Where do you want to go and when?",id:"prompt",modelValue:o.prompt,"onUpdate:modelValue":t[0]||(t[0]=i=>o.prompt=i),onEnter:s.generateItinerary,class:"w-full"},null,8,["modelValue","onEnter"]),a("div",J,[m(p,{onClick:s.generateItinerary,size:"sm","custom-class":"h-8 w-8 p-0!"},{default:w(()=>t[3]||(t[3]=[a("i",{class:"ph ph-arrow-right"},null,-1)])),_:1},8,["onClick"])])])],2),o.isLoading?(n(),l("div",U,[m(v),o.isLoadingTrip?(n(),l("span",Z,"Creating Trip Plan")):(n(),l("span",R,"Generating Daily Plans"))])):g("",!0),o.activities.length>0?(n(),l("div",F,t[5]||(t[5]=[a("span",{class:"text-zinc-500 text-xs"},"Agdayo AI can make mistakes. Always verify the activities and its location!",-1)]))):g("",!0),a("div",H,[o.activities.length>0?(n(),L(p,{key:0,class:"w-full",onClick:s.generateTrip},{default:w(()=>t[6]||(t[6]=[b("Save this plan")])),_:1},8,["onClick"])):g("",!0)]),(n(!0),l(T,null,_(s.groupedActivities,(i,f)=>(n(),L(E,{key:f,name:"fadeIn"},{default:w(()=>[i.type==="day"?(n(),l("span",W,"Day "+y(s.days.indexOf(i.iso)+1)+" - "+y(i.label),1)):g("",!0),i.type==="tag"?(n(),l("div",q,[t[7]||(t[7]=a("div",{class:"absolute w-full border-t border-dashed border-zinc-300"},null,-1)),a("span",Y,y(i.label),1)])):i.type==="activity"?(n(),l("div",{key:2,class:k(["flex flex-row gap-2 md:gap-4 fadeIn",`fadeIn-${f}`])},[m(x,{time:s.formatIsoDateToTime(i.data.datetime),isLast:!1},null,8,["time"]),m(C,{iconName:i.data.iconName,title:i.data.title,location:i.data.location,cost:i.data.cost,costNote:i.data.costNote,currency:i.data.costCurrency},null,8,["iconName","title","location","cost","costNote","currency"])],2)):g("",!0)]),_:2},1024))),128)),o.activities.length>0&&o.mapLoaded?(n(),l("div",K,[t[10]||(t[10]=a("div",{id:"map",class:"w-full h-[400px] my-4 rounded-lg shadow-md"},null,-1)),a("div",Q,[t[8]||(t[8]=a("p",{class:"font-semibold text-zinc-700"},"Itinerary Overview",-1)),a("ul",X,[(n(!0),l(T,null,_(s.days,(i,f)=>(n(),l("li",{key:f}," Day "+y(f+1)+": "+y(s.formatIsoDateToDate(i)),1))),128))]),a("button",{class:"mt-2 bg-blue-500 hover:bg-blue-600 text-white text-xs px-3 py-1 rounded-md",onClick:t[1]||(t[1]=(...i)=>s.resetZoom&&s.resetZoom(...i))}," Reset Zoom ")]),a("button",{class:"absolute bottom-4 right-4 z-10 bg-white p-2 rounded-full shadow-md hover:bg-gray-100 flex items-center justify-center",title:"My Location",onClick:t[2]||(t[2]=(...i)=>s.getUserLocation&&s.getUserLocation(...i))},t[9]||(t[9]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",class:"bi bi-geo-alt-fill text-blue-600",viewBox:"0 0 16 16"},[a("path",{d:"M4 4a3 3 0 1 1 6 0 3 3 0 0 1-6 0m6 0a4 4 0 1 0-8 0 4 4 0 0 0 8 0M7 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"})],-1)]))])):o.activities.length>0&&!o.mapLoaded?(n(),l("div",$," Loading Map... ")):g("",!0)]),m(I,null,{default:w(()=>[m(S,{variant:"error",ref:"dangerToast",message:o.dangerToast.message},null,8,["message"])]),_:1})],64)}const ut=P(O,[["render",tt]]);export{ut as default};
